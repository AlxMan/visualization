<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Elmer I Fast build Admin dashboard for any platform</title>
    <meta name="description" content="Elmer is a Dashboard & Admin Site Responsive Template by hencework."/>
    <meta name="keywords"
          content="admin, admin dashboard, admin template, cms, crm, Elmer Admin, Elmeradmin, premium admin templates, responsive admin, sass, panel, software, ui, dwh, web app, application"/>
    <meta name="author" content="hencework"/>

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Bootstrap Wysihtml5 css -->
    <link rel="stylesheet" href="vendors/bower_components/bootstrap3-wysihtml5-bower/dist/bootstrap3-wysihtml5.css"/>

    <!-- Data table CSS -->
    <link href="vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet"
          type="text/css"/>

    <!-- Custom CSS -->
    <link href="dist/css/style.css" rel="stylesheet" type="text/css">
    <!-- jQuery -->
    <script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
</head>

<body>
<!--/Preloader-->
<div class="wrapper   pimary-color-blue" style="min-height: 650px">
    <!-- Main Content -->
    <!-- Row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default card-view pa-0">
                <div class="panel-wrapper collapse in">
                    <div class="panel-body pa-0">
                        <div class="contact-list">
                            <div class="row" >
                                <!-- <aside class="col-xs-1">
                                 </aside>-->
                                <aside class="col-xs-1 col-md-1">
                                </aside>

                                <aside class="col-lg-10 col-md-8 pl-0">
                                    <div class="panel pa-0">
                                        <div class="panel-wrapper collapse in">
                                            <div class="panel-body  pa-0">
                                                <div class="table-responsive mb-30">
                                                    <table id="datable_1" class="table  display table-hover mb-30"
                                                           data-page-size="10">
                                                        <thead>
                                                        <tr>
                                                            <th>编号</th>
                                                            <th>姓名</th>
                                                            <th>Email</th>
                                                            <th>电话</th>
                                                            <th>创建时间</th>
                                                            <th>修改时间</th>
                                                            <th>操作</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        </tbody>
                                                        <aside class="col-lg-2 col-md-4 pr-0">
                                                            <div class="mt-20 mb-20 ml-15 mr-15">
                                                                <a href="#myModal" data-toggle="modal" title="Compose" class="btn btn-success btn-block">
                                                                    添加用户
                                                                </a>
                                                                <!-- Modal -->
                                                                <div aria-hidden="true" role="dialog" tabindex="-1" id="myModal" class="modal fade" style="display: none;">
                                                                    <div class="modal-dialog">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                                                                                </button>
                                                                                <h4 class="modal-title" >添加用户</h4>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <form class="form-horizontal form-material" >
                                                                                    <div class="form-group">
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请输入用户名" id="addName" name="username">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password" class="form-control"
                                                                                                   placeholder="请输入密码" id="addPwd" name="password">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password" class="form-control"
                                                                                                   placeholder="请确认密码" id="addPwd2" >
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请填写邮箱" id="addEmail" name="email">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请填写手机号码" id="addPhone" name="phone">
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <span id="errMsg"></span>
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button" class="btn btn-info waves-effect" data-dismiss="modal" onclick="save()">
                                                                                    添加</button>
                                                                                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">
                                                                                    取消</button>
                                                                            </div>
                                                                        </div>
                                                                        <!-- /.modal-content -->
                                                                    </div>
                                                                    <!-- /.modal-dialog -->
                                                                </div>
                                                                <!-- /.modal -->

                                                                <!-- Modal1 -->
                                                                <div aria-hidden="true" role="dialog" tabindex="-1" id="myModal1" class="modal fade" style="display: none;">
                                                                    <div class="modal-dialog">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                                                                                </button>
                                                                                <h4 class="modal-title" >更新用户</h4>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <form class="form-horizontal form-material" >
                                                                                    <div class="form-group">
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control" type="hidden" readonly="readonly"
                                                                                                   placeholder="用户名ID" id="updateId" name="username">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请输入用户名" id="updateName" name="username">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password" class="form-control"
                                                                                                   placeholder="请输入密码" id="updatePwd" name="password">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="password" class="form-control"
                                                                                                   placeholder="请确认密码" id="updatePwd2" >
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请填写邮箱" id="updateEmail" name="email">
                                                                                        </div>
                                                                                        <div class="col-md-12 mb-20">
                                                                                            <input type="text" class="form-control"
                                                                                                   placeholder="请填写手机号码" id="updatePhone" name="phone">
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <span id="errMsg1"></span>
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button" class="btn btn-info waves-effect" data-dismiss="modal" onclick="update()">
                                                                                    更新</button>
                                                                                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">
                                                                                    取消</button>
                                                                            </div>
                                                                        </div>
                                                                        <!-- /.modal1-content -->
                                                                    </div>
                                                                    <!-- /.modal1-dialog -->
                                                                </div>
                                                                <!-- /.modal1 -->

                                                            </div>
                                                        </aside>
                                                    </table>
                                                    <!--分页插件-->
                                                    <nav>
                                                        <ul class="pagination">
                                                            <li>
                                                                <a href="#" aria-label="Previous" onclick="left()">
                                                                    <span aria-hidden="true">&laquo;</span>
                                                                </a>
                                                            </li>

                                                            <li>
                                                                <a href="#" aria-label="Next" onclick="right()">
                                                                    <span aria-hidden="true">&raquo;</span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </nav>
                                                    <!-- 分页插件结束 -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </aside>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Row -->

</div>
<!-- /#wrapper -->

<!-- JavaScript -->

<!-- jQuery -->
<script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- wysuhtml5 Plugin JavaScript -->
<script src="vendors/bower_components/wysihtml5x/dist/wysihtml5x.min.js"></script>

<script src="vendors/bower_components/bootstrap3-wysihtml5-bower/dist/bootstrap3-wysihtml5.all.js"></script>

<!-- Fancy Dropdown JS -->
<script src="dist/js/dropdown-bootstrap-extended.js"></script>

<!-- Bootstrap Wysuhtml5 Init JavaScript -->
<script src="dist/js/bootstrap-wysuhtml5-data.js"></script>

<!-- Data table JavaScript -->
<!--<script src="vendors/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
<script src="dist/js/dataTables-data.js"></script>-->

<!-- Slimscroll JavaScript -->
<script src="dist/js/jquery.slimscroll.js"></script>

<!-- Owl JavaScript -->
<script src="vendors/bower_components/owl.carousel/dist/owl.carousel.min.js"></script>

<!-- Switchery JavaScript -->
<script src="vendors/bower_components/switchery/dist/switchery.min.js"></script>

<!-- Init JavaScript -->
<script src="dist/js/init.js"></script>

</body>
<script>

let prePage = 0;          //当前页的前一页
let nextPage = 0;         //当前页的后一页
let isFirstPage = false;  //是否为首页
let isLastPage = false;   //是否为末页

//页面查询，调用一个分页查询一页数据的方法
$(function () {
    findByPage(1);   //页面初始化默认查询第一页的数据
})

//查询后台的数据，动态展示的方法
function findByPage(pageNum) {
    //每次查询的时候都会生成新的tr li，所以方法之前要清空这两项
    $("tbody tr").remove();
    $("li[name='myli']").remove();

    //发送ajax请求，查询后台的数据
    $.post("/visualization/user/list.do", "pageNum="+pageNum+"&pageSize=10", function (data) {

        //初始化成员
        prePage = data.data.prePage;
        nextPage = data.data.nextPage;
        isFirstPage = data.data.isFirstPage;
        isLastPage = data.data.isLastPage;

        //获取查询到的一页数据list，循环生成tr td，把数据嵌套到tr td tbody中
        let list = data.data.list;
        //循环查到的一页用户数据
        for (let i = 0; i < list.length; i++) {
            let $tr = $("<tr>\n" +
                "<th>"+list[i].id+"</th>\n" +
                "<th>"+list[i].username+"</th>\n" +
                "<th>"+list[i].email+"</th>\n" +
                "<th>"+list[i].phone+"</th>\n" +
                "<th>"+list[i].createTime+"</th>\n" +
                "<th>"+list[i].updateTime+"</th>\n" +
                "<th>" +
                // "<a href='javascript:void(0)' class='text-inverse pr-10' title='Edit' data-toggle='modal' data-target='#myModal1' onclick='findById("+list[i].id+")'><i class=\"zmdi zmdi-edit txt-warning\"></i></a>" +
                "<a href='#myModal1' data-toggle='modal' title='Update' class='text-inverse pr-10' onclick='findById("+list[i].id+")'><i class=\"zmdi zmdi-edit txt-warning\"></i></a>"+
                "<a href='javascript:void(0)' class='text-inverse' title='Delete' data-toggle='tooltip' onclick='deleteById("+list[i].id+")'><i class='zmdi zmdi-delete txt-danger'></i></a>" +
                "</th>\n" +
                "</tr>");
            $("tbody").append($tr);
        }

        //动态生成页码
        let totalPages = data.data.pages;
        for (let i = 0; i < totalPages; i++) {
            let $li = $("<li name='myli'><a href='#' onclick='findByPage("+(i+1)+")'>"+(i+1)+"</a></li>");
            //把li标签添加到最后一个li标签之前
            $("li:last").before($li);
            //判断当前页并设置标注
            if (data.data.pageNum == (i+1)) {
                $li.prop("class", "active");
            }
        }

    }, "json")
}

//点击向左的方法
function left() {
    //判断当前页是否为首页，如果是首页，return停止方法
    if (isFirstPage) {
        return;
    }
    //如果不是首页，调用findByPage(前一页)
    findByPage(prePage);
}

//点击向右的方法
function right() {
    //判断当前页是否为末页，如果是末页，return停止方法
    if (isLastPage) {
        return;
    }
    //如果不是末页，调用findByPage(后一页)
    findByPage(nextPage);
}

//添加用户的方法
function save() {
    //获取表单数据
    let name = $("#addName").val();
    let pwd = $("#addPwd").val();
    let pwd2 = $("#addPwd2").val();
    let email = $("#addEmail").val();
    let phone = $("#addPhone").val();

    //判断两次输入密码是否一致
    if (pwd != pwd2) {
        alert("两次输入密码不一致")
        $("#errMsg").html("两次输入密码不一致");
        window.location.reload();
    }else {
        // 发送post请求 地址，参数， 回调函数
        $.post("/visualization/user/add.do", {"username":name,"password":pwd,"email":email,"phone":phone}, function (data) {
            if (data.status == 0) {
                alert("添加成功");
                window.location.reload();
            }else {
                alert("添加失败 " + data.msg);
                window.location.reload();
            }
        },"json")
    }
}

//删除用户的方法
function deleteById(id) {
    //询问用户是否确认删除
    let flag = window.confirm("是否确认删除？");
    if (!flag) {
        return;
    }
    //发送ajax请求删除后台数据 ， 参数为id
    $.post("/visualization/user/deleteUser.do","id="+id,function (data) {
        if (data.status == 0) {
            window.location.reload();
        }
    },"json")
}

// 点击修改信息按钮执行该方法，并通过回调函数中拿到的data数据回显用户信息(根据标签id对应回显)------------------------------
//根据id查找用户信息
function findById(id) {
    //发送ajax请求获取该id的用户信息
    $.post("/visualization/user/findById.do","id="+id,function (data) {
        $("#updateId").val(data.data.id);
        $("#updateName").val(data.data.username);
        $("#updatePwd").val(data.data.password);
        $("#updatePwd2").val(data.data.password);
        $("#updateEmail").val(data.data.email);
        $("#updatePhone").val(data.data.phone);
    },"json")
}

//更新用户的方法
function update() {
    // 手机号码和邮箱的正则表达式验证规则
    let phoneReg=/^[1][3,4,5,7,8][0-9]{9}$/;
    let emailReg=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;

    //获取表单数据
    let id = $("#updateId").val();
    let name = $("#updateName").val();
    let pwd = $("#updatePwd").val();
    let pwd2 = $("#updatePwd2").val();
    let email = $("#updateEmail").val();
    let phone = $("#updatePhone").val();

    //前台验证两次密码是否一致、邮箱格式和手机号码格式是否一致
    if (pwd != pwd2) {
        alert("两次输入密码不一致");
        // $("#errMsg").html("两次输入密码不一致");
    }else if (!emailReg.test(email)){
        alert("邮箱格式不正确");
        // $("#errMsg").html("手机号码格式不正确");
    }else if (!phoneReg.test(phone)){
        alert("手机号码格式不正确");
    } else {
        //发送ajax请求更新后台数据
        $.post("/visualization/user/update.do",{"username":name,"password":pwd,"email":email,"phone":phone,"id":id},function (data) {
            if (data.status == 0) {
                alert("更新成功");
                window.location.reload();
            }else {
                alert("更新失败 " + data.msg);
                window.location.reload();
            }
        },"json")
    }
}

</script>
</html>
